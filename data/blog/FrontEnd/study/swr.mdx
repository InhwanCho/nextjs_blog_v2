---
title: 'SWR (state-while-revalidate)'

tags:
  - swr

date: 2024-01-12
---

## SWR

reactQuery와 유사합니다

page에 접근 -> SWR(fetch data -> 캐싱) -> 다른 페이지(혹은 다른 화면) -> page 접근 ->
SWR(API 호출 - 데이터가 바뀐게 있는지 확인 - loading이 없고 캐시에 있는 데이터 먼저 사용)
-> 바뀐게 없으면 기존의 data(캐시에 있는) 사용 -> 바뀐게 있으면 data update

즉, 기존의 fetch를 사용하면 `page에 접근 했을때 마다` undefined와 data를 받는데,
SWR를 사용하면 data변경이 없으면 처음 `page에 접근 할 때만` data를 받게됩니다.

## 기존의 fetch 방법과 비교

```js:기존방법.tsx
import { useRouter } from "next/router";
import { useEffect, useState } from "react";

export default function Home() {
  const [user, setUser] = useState();
  const router = useRouter();
  useEffect(() => {
    fetch("/api/users/home")
      .then((response) => response.json())
      .then((data) => {
        if (!data.ok) {
          return router.replace("/login");
        } else {
          setUser(data.profile);
        }
      })
      .catch((error) => {
        console.log(error);
      });
  }, [router]);
  return user;
}
```

- 방법 1. 상위 layout에 SWRConfig를 감싸기(추천)

```js:layout.tsx
<SWRConfig value={{
  fetcher: (url: string) =>
          fetch(url).then((response) => response.json()),
          refreshInterval:2000,
      }}>
  <Component/>
</SWRConfig>
```

```js:SWR.tsx
import useSWR from "swr";

export default function useUser() {
  const { data, error } = useSWR('/api/users/home')
  // ...
}
```

- 방법 2. SWRConfig를 사용하지 않고 하나씩 fetcher를 생성

```js:SWR.tsx
import useSWR from "swr";

const fetcher = (url: string)=> fetch(url).then((response)=>response.json())

export default function useUser() {
  const { data, error } = useSWR('/api/users/home', fetcher)
  const router = useRouter();
  useEffect(()=>{
    if(data && !data.ok){
      router.replace('/login')
    }
  },[data, router])

  return { user: data?.profile, isLoading: !data && !error };
```
